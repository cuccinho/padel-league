{% extends "base.html" %}
{% block content %}
<h1 class="text-center">Dashboard</h1>

<div class="row">
    <div class="col-md-6">
        <h4>Filter Player Combinations</h4>
        <form id="filter-form">
            <select id="player1" class="form-control mb-2">
                <option value="all">All Players</option>
                {% for player in players %}
                <option value="{{ player.name }}">{{ player.name }}</option>
                {% endfor %}
            </select>
            <select id="player2" class="form-control mb-2">
                <option value="all">All Players</option>
                {% for player in players %}
                <option value="{{ player.name }}">{{ player.name }}</option>
                {% endfor %}
            </select>
            <button type="button" id="apply-filter" class="btn btn-primary">Apply Filter</button>
        </form>
    </div>

    <div class="col-md-6">
        <h4>Pie Chart</h4>
        <canvas id="playerCombinationChart"></canvas>
    </div>
</div>

<script>
    const stats = {{ player_combination_stats | tojson }};
    const ctx = document.getElementById("playerCombinationChart").getContext("2d");

    let currentData = { wins: 0, losses: 0 };

    const chart = new Chart(ctx, {
        type: "pie",
        data: {
            labels: ["Wins", "Losses"],
            datasets: [{
                data: [currentData.wins, currentData.losses],
                backgroundColor: ["#4CAF50", "#FF5733"]
            }]
        }
    });

    document.getElementById("apply-filter").addEventListener("click", () => {
        const player1 = document.getElementById("player1").value;
        const player2 = document.getElementById("player2").value;

        const key = `${player1} & ${player2}`;
        const selectedStats = stats[key] || { wins: 0, losses: 0 };

        chart.data.datasets[0].data = [selectedStats.wins, selectedStats.losses];
        chart.update();
    });
</script>
{% endblock %}
